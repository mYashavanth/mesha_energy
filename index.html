<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="./assets/css/index.css" />
    <link rel="stylesheet" href="./assets/css/navbar.css" />
    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <!-- Google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <!-- ag-chart -->
    <script src="https://cdn.jsdelivr.net/npm/ag-charts-community/dist/umd/ag-charts-community.js"></script>
  </head>
  <body>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>
    <div id="root">
      <nav id="nav">
        <!-- <figure>
          <img src="./assets/images/index/logo.png" alt="logo" />
        </figure>
        <div class="navContent">
          <div class="navItems active">
            <i class="bi bi-house-door" style="font-size: 20px"></i>
            <p>Dashboard</p>
          </div>
          <div class="navItems">
            <i class="bi bi-person-workspace" style="font-size: 20px"></i>
            <p>Mesha Customer Management</p>
          </div>
          <div class="accordion" id="accordionExample">
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button
                  class="accordion-button collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#flush-collapseOne"
                  aria-expanded="false"
                  aria-controls="flush-collapseOne"
                >
                  <i class="bi bi-ev-front" style="font-size: 20px"></i>
                  <p>Device Management</p>
                </button>
              </h2>
              <div
                id="flush-collapseOne"
                class="accordion-collapse collapse"
                data-bs-parent="#accordionExample"
              >
                <div class="navItems">
                  <i
                    class="bi bi-house-door"
                    style="font-size: 20px; color: transparent"
                  ></i>
                  <p>Device Management 1</p>
                </div>
                <div class="navItems">
                  <i
                    class="bi bi-house-door"
                    style="font-size: 20px; color: transparent"
                  ></i>
                  <p>Device Management 2</p>
                </div>
              </div>
            </div>
          </div>
          <div class="navItems">
            <i class="bi bi-people" style="font-size: 20px"></i>
            <p>Customer Management</p>
          </div>
          <div class="navItems">
            <i class="bi bi-pin-map" style="font-size: 20px"></i>
            <p>Map View</p>
          </div>
          <div class="navItems">
            <i class="bi bi-gear" style="font-size: 20px"></i>
            <p>Settings</p>
          </div>
          <div class="navItems">
            <i class="bi bi-person" style="font-size: 20px"></i>
            <p>Profile</p>
          </div>
          <div class="navItems">
            <i class="bi bi-question-octagon" style="font-size: 20px"></i>
            <p>FAQs</p>
          </div>
          <div class="navItems">
            <i class="bi bi-power" style="font-size: 20px"></i>
            <p>Logout</p>
          </div>
        </div> -->
      </nav>
      <main id="main">
        <div class="topSection">
          <h1>Device Parameters</h1>
          <p>View detailed device parameters for multiple data points</p>
        </div>
        <div id="deviceIdData">
          <div class="customerName">
            <p>Customer Name:</p>
            <p id="customerName">Liveguard</p>
          </div>
          <div class="vr" style="height: 25px; width: 2px"></div>
          <div class="deviceId">
            <p>Device ID:</p>
            <select name="deviceId" id="deviceId"></select>
          </div>
          <div class="vr" style="height: 25px; width: 2px"></div>
          <div class="dateAndTime">
            <p>Date and Time:</p>
            <p id="date">--/--/----</p>
            <p id="time">00:00</p>
          </div>
        </div>
        <div id="deviceDataCardContainer">
          <!-- voltage 1 card -->
          <div class="deviceDataCard">
            <div class="deviceDataCardContent">
              <p>VOLTAGE 1 (B1)</p>
              <h1 id="voltage1">0.00</h1>
            </div>
            <div class="deviceDataCardImg" style="background-color: #feffde">
              <img src="./assets/images/index/voltage.svg" alt="voltage" />
            </div>
          </div>
          <!-- voltage 2 card -->
          <div class="deviceDataCard">
            <div class="deviceDataCardContent">
              <p>VOLTAGE 2 (B2)</p>
              <h1 id="voltage2">0.00</h1>
            </div>
            <div class="deviceDataCardImg" style="background-color: #feffde">
              <img src="./assets/images/index/voltage.svg" alt="voltage" />
            </div>
          </div>
          <!-- voltage 3 card -->
          <div class="deviceDataCard">
            <div class="deviceDataCardContent">
              <p>VOLTAGE 3 (B3)</p>
              <h1 id="voltage3">0.00</h1>
            </div>
            <div class="deviceDataCardImg" style="background-color: #feffde">
              <img src="./assets/images/index/voltage.svg" alt="voltage" />
            </div>
          </div>
          <!-- voltage 4 card -->
          <div class="deviceDataCard">
            <div class="deviceDataCardContent">
              <p>VOLTAGE 4 (B4)</p>
              <h1 id="voltage4">0.00</h1>
            </div>
            <div class="deviceDataCardImg" style="background-color: #feffde">
              <img src="./assets/images/index/voltage.svg" alt="voltage" />
            </div>
          </div>
          <!-- battery bank voltage -->
          <div class="deviceDataCard">
            <div class="deviceDataCardContent">
              <p>BATTERY BANK VOLTAGE</p>
              <h1 id="batteryBankVoltage">0.00</h1>
            </div>
            <div class="deviceDataCardImg" style="background-color: #feffde">
              <img src="./assets/images/index/voltage.svg" alt="voltage" />
            </div>
          </div>
          <!-- current card -->
          <div class="deviceDataCard">
            <div class="deviceDataCardContent">
              <p>CURRENT (A)</p>
              <h1 id="current">0.00</h1>
            </div>
            <div
              class="deviceDataCardImg"
              style="background-color: #ecfff6; padding: 20px 24px"
            >
              <img src="./assets/images/index/current.svg" alt="current" />
            </div>
          </div>
          <!-- temperature card -->
          <div class="deviceDataCard">
            <div class="deviceDataCardContent">
              <p>TEMPERATURE (C)</p>
              <h1 id="temperature">0.00</h1>
            </div>
            <div class="deviceDataCardImg" style="background-color: #fff3e2">
              <img src="./assets/images/index/temperature.svg" alt="temp" />
            </div>
          </div>
          <!-- speed card -->
          <div class="deviceDataCard">
            <div class="deviceDataCardContent">
              <p>SPEED (KM/H)</p>
              <h1 id="speed">0.00</h1>
            </div>
            <div class="deviceDataCardImg" style="background-color: #f5f6f7">
              <img src="./assets/images/index/speed.svg" alt="speed" />
            </div>
          </div>
          <!-- distance card -->
          <div class="deviceDataCard">
            <div class="deviceDataCardContent">
              <p>DISTANCE (KM)</p>
              <h1 id="distance">0.00</h1>
            </div>
            <div class="deviceDataCardImg" style="background-color: #e0ffd9">
              <img src="./assets/images/index/distance.svg" alt="distance" />
            </div>
          </div>
        </div>

        <div
          class="myChart"
          id="batteryVoltageChart"
          style="height: 600px; margin-bottom: 20px"
        ></div>
        <div
          class="myChart"
          id="currentChart"
          style="height: 600px; margin-bottom: 20px"
        ></div>
        <div
          class="myChart"
          id="bankVoltageChart"
          style="height: 600px; margin-bottom: 20px"
        ></div>
      </main>
    </div>

    <script>
      // Function to generate dummy data for the last 24 hours
      function generateDummyData() {
        const data = [];
        const now = new Date();
        for (let i = 0; i < 1440; i++) {
          // 1440 minutes in 24 hours
          const date = new Date(now - i * 60 * 1000); // Get the time for each minute
          const log_time = date.toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
          });

          data.push({
            log_time,
            b1: (Math.random() * (13.5 - 12.5) + 12.5).toFixed(2), // Random voltage between 12.5 and 13.5
            b2: (Math.random() * (13.5 - 12.5) + 12.5).toFixed(2),
            b3: (Math.random() * (13.5 - 12.5) + 12.5).toFixed(2),
            b4: (Math.random() * (13.5 - 12.5) + 12.5).toFixed(2),
            current:
              (Math.random() * (1.5 - 0.1) + 0.1).toFixed(2) *
              (Math.random() < 0.5 ? -1 : 1), // Random current between -1.5 and 1.5
          });
        }
        return data.reverse(); // Reverse to get latest data at the end
      }

      // Function to update the charts with new data
      function updateCharts() {
        // Clear existing charts
        document.getElementById("batteryVoltageChart").innerHTML = "";
        document.getElementById("currentChart").innerHTML = "";
        document.getElementById("bankVoltageChart").innerHTML = "";

        // Generate the dummy data
        const data = generateDummyData();

        // Parse log_time and convert voltage/current strings to numbers
        const parseData = data.map((entry) => ({
          log_time: entry.log_time, // Use log_time directly as hh:mm:ss
          b1: parseFloat(entry.b1), // Convert string to float for b1
          b2: parseFloat(entry.b2), // Convert string to float for b2
          b3: parseFloat(entry.b3), // Convert string to float for b3
          b4: parseFloat(entry.b4), // Convert string to float for b4
          current: parseFloat(entry.current), // Convert string to float for current
          bank_voltage:
            parseFloat(entry.b1) +
            parseFloat(entry.b2) +
            parseFloat(entry.b3) +
            parseFloat(entry.b4), // Sum the battery voltages
        }));

        function getXAxisType(dataLength) {
          if (dataLength > 120) {
            return "category"; // Use categories for more data points
          }
          return "number"; // Use number for less data points
        }

        // First Chart: Battery Voltages (b1, b2, b3, b4)
        const batteryVoltageOptions = {
          container: document.getElementById("batteryVoltageChart"),
          title: {
            text: "Battery Voltages (b1, b2, b3, b4)",
          },
          data: parseData,
          series: [
            {
              type: "line",
              xKey: "log_time",
              yKey: "b1",
              yName: "b1",
              stroke: "#f56a79",
              interpolation: { type: "smooth" },
            },
            {
              type: "line",
              xKey: "log_time",
              yKey: "b2",
              yName: "b2",
              stroke: "#6794dc",
              interpolation: { type: "smooth" },
            },
            {
              type: "line",
              xKey: "log_time",
              yKey: "b3",
              yName: "b3",
              stroke: "#7cb342",
              interpolation: { type: "smooth" },
            },
            {
              type: "line",
              xKey: "log_time",
              yKey: "b4",
              yName: "b4",
              stroke: "#ffca28",
              interpolation: { type: "smooth" },
            },
          ],
          axes: [
            {
              type: getXAxisType(parseData.length),
              position: "bottom",
              title: { text: "Time (hh:mm:ss)" },
            },
            {
              type: "number",
              position: "left",
              title: { text: "Voltage (V)" },
            },
          ],
          navigator: {
            enabled: true,
            height: 40,
            min: 23 / 24,
            max: 24 / 24,
            mask: {
              fill: "#0d5e36", // Customize the fill color of the selection area
              stroke: "#0d5e36", // Customize the stroke of the selection area
            },
            minHandle: {
              fill: "#0d5e36", // Color of the left handle
              stroke: "#0d5e36", // Stroke color of the left handle
              width: 10, // Width of the handle
              height: 20, // Height of the handle
            },
            maxHandle: {
              fill: "#0d5e36", // Color of the right handle
              stroke: "#0d5e36", // Stroke color of the right handle
              width: 10,
              height: 20,
            },
          },
          interactions: {
            tooltip: {
              enabled: true,
            },
          },
        };
        agCharts.AgCharts.create(batteryVoltageOptions);

        // Second Chart: Current
        const currentOptions = {
          container: document.getElementById("currentChart"),
          title: {
            text: "Current Over Time",
          },
          data: parseData,
          series: [
            {
              type: "line",
              xKey: "log_time",
              yKey: "current",
              yName: "Current (A)",
              stroke: "#8e44ad",
              interpolation: { type: "smooth" },
            },
          ],
          axes: [
            {
              type: getXAxisType(parseData.length),
              position: "bottom",
              title: { text: "Time (hh:mm:ss)" },
            },
            {
              type: "number",
              position: "left",
              title: { text: "Current (A)" },
            },
          ],
          navigator: {
            enabled: true,
            height: 40,
            min: 23 / 24,
            max: 24 / 24,
            mask: {
              fill: "#0d5e36", // Customize the fill color of the selection area
              stroke: "#0d5e36", // Customize the stroke of the selection area
            },
            minHandle: {
              fill: "#0d5e36", // Color of the left handle
              stroke: "#0d5e36", // Stroke color of the left handle
              width: 10, // Width of the handle
              height: 20, // Height of the handle
            },
            maxHandle: {
              fill: "#0d5e36", // Color of the right handle
              stroke: "#0d5e36", // Stroke color of the right handle
              width: 10,
              height: 20,
            },
          },
          interactions: {
            tooltip: {
              enabled: true,
            },
          },
        };
        agCharts.AgCharts.create(currentOptions);

        // Third Chart: Bank Voltage (Sum of b1, b2, b3, b4)
        const bankVoltageOptions = {
          container: document.getElementById("bankVoltageChart"),
          title: {
            text: "Bank Voltage (Sum of b1, b2, b3, b4)",
          },
          data: parseData,
          series: [
            {
              type: "line",
              xKey: "log_time",
              yKey: "bank_voltage",
              yName: "Bank Voltage",
              stroke: "#e74c3c",
              interpolation: { type: "smooth" },
            },
          ],
          axes: [
            {
              type: getXAxisType(parseData.length),
              position: "bottom",
              title: { text: "Time (hh:mm:ss)" },
            },
            {
              type: "number",
              position: "left",
              title: { text: "Voltage (V)" },
            },
          ],
          navigator: {
            enabled: true,
            height: 40,
            min: 23 / 24,
            max: 24 / 24,
            mask: {
              fill: "#0d5e36", // Customize the fill color of the selection area
              stroke: "#0d5e36", // Customize the stroke of the selection area
            },
            minHandle: {
              fill: "#0d5e36", // Color of the left handle
              stroke: "#0d5e36", // Stroke color of the left handle
              width: 10, // Width of the handle
              height: 20, // Height of the handle
            },
            maxHandle: {
              fill: "#0d5e36", // Color of the right handle
              stroke: "#0d5e36", // Stroke color of the right handle
              width: 10,
              height: 20,
            },
          },
          interactions: {
            tooltip: {
              enabled: true,
            },
          },
        };
        agCharts.AgCharts.create(bankVoltageOptions);
      }

      // Initial chart generation
      updateCharts();

      // Refresh charts every minute
      setInterval(updateCharts, 10000);
    </script>
  </body>
</html>
<script src="./assets/js/navbar.js"></script>
<script src="./assets/js/index.js"></script>
